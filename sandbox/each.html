<html>

<head>
    <script src='../jquery.js'></script>
    <script src='../partial.js'></script>
    <script src='./users.data.js'></script>
    <script type='text/javascript'>
        $(() => {
            const API = 'https://jsonplaceholder.typicode.com/posts';
            (() => {
                const hi = list => list.forEach(console.log);
                const hi2 = _.each(console.log);
                // hi(_.range(5)); // 0 1 2 3 4 출력
                hi2(_.range(5)); // 0 1 2 3 4 출력
            })//();

            const delay = result => new Promise(resolve => setTimeout(() => resolve(result), 1000)); // 미실행
            // let list = _.each([1, 2, 3], v => console.log(v)); // 구문도 실행하고 배열객체를 변수에도 담는다.
            // console.log(list);  // [1,2,3] , 즉시 리턴
            // delay(5).then(console.log);

            // let list2 = _.each([1, 2, 3], v => delay(v).then(console.log));
            // list2.then(console.table);

            // let list3 = _.each([1, 2, 3], v => _.go(delay(v), console.log));    // _.go로도 비동기 가능
            // list3.then(console.table);

            // let list4 = _.each([1, 2, 3], _.pipe(delay, console.log));  //_.pipe로도 비동기 가능
            // console.log(list4);
            // list4.then(console.table);

            // const update = id => delay({ id: id, updated_at: new Date() });
            // let ids = [5, 10, 20];
            // const format = v => v.replace(/T/g, ' ').replace(/\.\d+Z/g, '');
            // _.go(ids,
            //     _.map(id => update(id)),
            //     JSON.stringify,
            //     format,
            //     console.table
            // )

            // _.find : true를 만나면 그만 돌기
            // _.find(_.range(1, 11), (v, i) => {
            //     console.log(v, i);
            //     return delay(v > 5); // 6까지 console.log 하고 멈춘다.
            // });

            // var a = 10;
            // _.find([
            //     () => { console.log(false); return delay(false) },
            //     () => { console.log('a==10'); return delay(a == 10) }, // 여기서 멈춘다.
            //     () => { console.log('1<2'); return delay(1 < 2) },
            //     () => { console.log(true); return delay(true) },
            // ], fn => fn())

            _.go(_.range(1, 10, 2), _.map(v => delay(v * 10).then(console.log)));    // 매 1초마다 출력
            _.go(_.range(1, 10, 2), _.map(v => delay(v * 10)), console.log);    // 5초뒤 한꺼번에 출력

            // const ajax = result => fetch(result);
            // ajax(API).then(console.log).catch(console.error).finally(() => console.log('finally called.'));

            // list;

            // _.each를 이용하여 체크된 항목 삭제
            // $('#task_app .remove').on('click', () => {
            //     let $inputs = $('#task_app .task_list input:checked');
            //     let lis = _.map($inputs, input => input.closest('li'));
            //     let ids = _.map(lis, li => parseInt(li.getAttribute('task_id')));
            //     $.get('https://jsonplaceholder.typicode.com/posts', ids).then(() => {
            //         _.each(lis, li => li.remove());
            //     });
            // });

            // _.pipe 활용
            $('#task_app .remove').on('click', __( //=_.pipe(
                // version 1
                // () => $(':input:checked'),
                // _.map(input => input.closest('li')), // #arg
                // _.tap(  // 내부의 함수들 모두 실행 후 처음 받은 인자(#arg) 리턴
                //     _.map(li => parseInt(li.getAttribute('task_id'))),  // [..] 리턴
                //     _($.get, 'API') //, _, d => console.log(d))
                //     //윗 줄의 리턴값([..]) 내장, 
                //     // _()는 Partial Application: 두 개 이상의 인자가 주어질 때, 첫 번째 인자로 함수, 나머지에 전달될 인자로 하는 새로운 함수 리턴
                // ),
                // // console.log
                // lis => $(lis).remove()

                // version 2
                _.c(':input:checked'), $,   //_.constant: 받아둔 값을 리턴하는 함수를 리턴
                _.map(_('closest', 'li')),
                _.tap(
                    _.map(__(_('getAttribute', 'task_id'), parseInt)),
                    // console.log
                    _($.get, API)
                ),
                $, _('remove')
            )); //

        }); // doc ready
    </script>

<body>
    <div id='task_app'>
        <button type="button" class="remove">삭제</button>
        <ul class="task_list">
            <li task_id="3"><input type="checkbox" checked /></li>
            <li task_id="2"><input type="checkbox" /></li>
            <li task_id="1"><input type="checkbox" checked /></li>
        </ul>
    </div>

</body>

</html>